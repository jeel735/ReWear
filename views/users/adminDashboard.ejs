<% layout("/layouts/boilerplate") %>

<div class="container admin-dashboard">
  <h1 class="admin-heading">Welcome Admin, <%= user.username %>!</h1>
  <p class="admin-subtitle">This is the <strong>Admin Dashboard</strong>.</p>

  <!-- Admin Info -->
  <section class="admin-profile glass-card">
    <img src="/images/admin-avatar.png" alt="Admin Profile" class="admin-pic" onerror="this.src='https://img.icons8.com/ios-filled/100/user-male-circle.png';">
    <div>
      <h2>Admin Panel</h2>
      <p>Welcome, <strong><%= user.username %></strong></p>
    </div>
  </section>

  <!-- üîÅ Swap Requests -->
  <section class="section">
    <h3>üîÅ Swap Requests</h3>
    <% if (swaps.length === 0) { %>
      <p>No swap requests found.</p>
    <% } else { %>
      <table>
        <thead>
          <tr>
            <th>Sender</th>
            <th>Receiver</th>
            <th>Offered Item</th>
            <th>Requested Item</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% swaps.forEach(swap => { %>
            <tr>
             <td><%= swap.senderId?.username || 'Deleted User' %></td>
<td><%= swap.receiverId?.username || 'Deleted User' %></td>
<td><%= swap.senderItemId?.title || 'Deleted Item' %></td>
<td><%= swap.receiverItemId?.title || 'Deleted Item' %></td>

              <td><%= swap.status %></td>
              <td>
                <% if (swap.status === 'pending') { %>
                  <form action="/admin/swaps/<%= swap._id %>/approve" method="POST" style="display:inline;">
                    <button class="btn btn-approve">Approve</button>
                  </form>
                  <form action="/admin/swaps/<%= swap._id %>/reject" method="POST" style="display:inline;">
                    <button class="btn btn-reject">Reject</button>
                  </form>
                <% } else { %>
                  <em><%= swap.status %></em>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>
  </section>
</div>

<% if (currUser) { %>
  <div class="logout-container">
    <a href="/logout" class="logout-button">Log Out</a>
  </div>
<% } %>

<style>
  body {
    background: linear-gradient(to bottom right, #6a0572, #320d3e);
    color: white;
  }

  .admin-dashboard {
    max-width: 1200px;
    margin: 40px auto;
    padding: 0 20px;
  }

  .admin-heading {
    font-size: 2.5rem;
    font-weight: bold;
    text-align: center;
  }

  .admin-subtitle {
    text-align: center;
    margin-bottom: 30px;
    font-size: 1.2rem;
    color: #ddd;
  }

  .admin-profile {
    display: flex;
    align-items: center;
    padding: 20px;
    gap: 20px;
    margin-bottom: 40px;
  }

  .admin-pic {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid #fff;
  }

  .section {
    margin-bottom: 50px;
  }

  .section h3 {
    font-size: 1.6rem;
    margin-bottom: 20px;
    color: #f1f1f1;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(255,255,255,0.1);
    color: white;
  }

  th, td {
    padding: 12px 16px;
    border: 1px solid #ccc;
    text-align: left;
  }

  th {
    background: rgba(255,255,255,0.2);
  }

  .btn {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
    margin: 2px;
  }

  .btn-approve {
    background: #28a745;
    color: white;
  }

  .btn-reject {
    background: #dc3545;
    color: white;
  }

  .btn:hover {
    opacity: 0.85;
  }

  .logout-container {
    text-align: center;
    margin-top: 40px;
  }

  .logout-button {
    display: inline-block;
    padding: 10px 20px;
    font-weight: 600;
    font-size: 16px;
    color: white;
    background: linear-gradient(to right, #ff416c, #ff4b2b);
    border: none;
    border-radius: 8px;
    text-decoration: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: background 0.3s ease, transform 0.2s ease;
  }

  .logout-button:hover {
    transform: translateY(-2px);
    background: linear-gradient(to right, #ff4b2b, #ff416c);
    text-decoration: none;
  }
</style>
